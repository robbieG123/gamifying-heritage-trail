<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <title>Dundee Ghost Trail</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
     integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
     crossorigin=""/>
     <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
     integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
     crossorigin=""></script>
  </head>
  <body>
    <main>
        <div class="container text-center">
            <h1>Map Screen</h1>

            <div id="map"></div>

            <div class="row d-flex position-relative" >
                <div id="catch" style="display: none;">
                    <div class="col" id="box">
                        <a  href="CatchScreen.html" class="stretched-link">CATCH</a>
                    </div>
                </div>
            </div>
        </div>
    </main>
  </body>
</html>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js">//leafletAPI for the map</script>


<script>
    // Geolocation Code from https://www.section.io/engineering-education/how-to-build-a-real-time-location-tracker-using-leaflet-js/
    //creates the map
    var map_init = L.map('map', {
            center: [56.461693858992, -2.9584546440361428],
            zoom: 15
        });
        circleRadius = 50;
        // creates open street map layer
        var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map_init);
        //finds current position of users device
        L.Control.geocoder().addTo(map_init);
        if (!navigator.geolocation) {
            console.log("Your browser doesn't support geolocation feature!")
        } else {
            setInterval(() => {
                navigator.geolocation.getCurrentPosition(getPosition)   
            }, 5000);
        };
        var marker, circle, lat, long, accuracy;

        function getPosition(position) {
            lat = position.coords.latitude
            long = position.coords.longitude
            accuracy = position.coords.accuracy

            if (marker) {
                map_init.removeLayer(marker)
            }

            if (circle) {
                map_init.removeLayer(circle)
            }
            var latlng = L.latLng([lat, long])
            //console.log("yes!");
            marker = L.marker(latlng)
            circle = L.circle(latlng, { radius: accuracy })

            var featureGroup = L.featureGroup([marker, circle]).addTo(map_init);

            //map_init.fitBounds(featureGroup.getBounds())

            console.log("Your coordinate is: Lat: " + lat + " Long: " + long + " Accuracy: " + accuracy);
            for (let i = 0; i < circles.length; i++) {
                var circleLatlng = L.latLng(circles[i])
                
                isMarkerInsideCircle(latlng, circleLatlng, circleRadius, i)
            }
            
        }

    
    const circles = [[56.461693858992, -2.9584546440361428, ]//HMS Unicorn
                    , [56.45754264075013, -2.967002643977912]//V&A
                    , [56.457931596431294, -2.976493584807401]//[test]Dundee Rep Theatre
                    , [56.4473698, -2.9855801]//[test]Middle of the River
                    , [56.45784893512836, -2.974880741263478]//[test] My flat
                    , [56.45696385016537, -2.9688912702269348]// Discovery
                    , [56.45797604519422, -2.9743101952862383]// DMA Headquarters
                    , [56.45840442854417, -2.9824555984409122]// Dundee Uni
                    , [56.461442520320624, -2.983517639643721]// Verdant Works
                    , [56.46241918920453, -2.9709972375674463]// McManus Galleries
                    , [56.46489142163189, -2.9641433607646053]// Wishart's Arch
                    ];

    const locationData = [["HMS Unicorn", "The HMS Unicorn is the oldest surviving ship in Scotland. It was launched in 1824 after being built in Chatham Dockyard in Kent. The ship was built for war however, was launched just after the end of the naval wars against Napolean so was never used in real combat. Instead, it was kept in 'ordinary' as a reserve ship until 1873 when it was sent to Dundee to be used as a training ship, which it carried out for nearly 100 years until 1968 when it was considered to be scrapped. However, The Unicorn Preservation Society (UPS) was formed and managed to prevent this from happening and to keep it as a landmark for the city, where it stays today", "https://upload.wikimedia.org/wikipedia/commons/thumb/7/75/HMS_Unicorn%2C_Dundee_002.jpg/450px-HMS_Unicorn%2C_Dundee_002.jpg"]
                        ,["The V&A Dundee", "The V&A Dundee was opened on the 15th September 2018, becoming the first design museum in Scotland and the first Victoria and Albert museum outside London. The design of the building was decided by a competition in 2010. The winner was Japanese architect, Kengo Kuma who said his design was inspired by the eastern cliff edges of Scotland. Construction started in April 2014 and cost Â£80.1 Million to complete.", "https://d363suj4pdptk4.cloudfront.net/externalApps/b4764c1e-e783-4381-aa97-e1f506037d14/conversion/sirtrevor--1072/assets/14960"]
                        ,["This is some information about the Rep"]
                        ,["River Tay","This is some information about the River", "https://www.dundee.com/sites/default/files/styles/grid_wide/public/Attractions%20-%20River%20Tay.jpg?itok=6fx9VxdB"]
                        ,["The Flat", "This is some information about the Flat", "https://i.pinimg.com/236x/72/c8/d3/72c8d340ec93c446169f55f105a39851--bts-pictures-scissors.jpg"]
                        ,["RMS Discovery", "This is some information about the Discovery"]
                        ,["DMA Designs HQ", "This is some information about the original DMA designs HQ", "http://www.javalemmings.com/DMA/Office1/Images/large/Office_4.jpg"]
                        ,["Dundee University", "This is some information about the University", ""]
                        ,["Verdant Works", "This is some information about the University", ""]
                        ,["McManus Galleries", "This is some information about the University", ""]
                        ,["Wishart's Arch", "This is some information about the University", ""]]

    for (let i = 0; i < circles.length; i++) {
        L.circle(circles[i], circleRadius).addTo(map_init);
        L.marker(circles[i]).addTo(map_init);
    }
    

    function isMarkerInsideCircle(markerLatLng, circleCenterLatLng, circleRadius, locationNum){
        // markerLatLng and circleCenterLatLng must be instance of L.latlng class.
        // you can create an instance like this L.latLng(lat, lng);
        console.log(markerLatLng.distanceTo(circleCenterLatLng));
        console.log(circleRadius)
        if (markerLatLng.distanceTo(circleCenterLatLng) <= circleRadius){
            console.log("yes!");
            toggleText()
            document.getElementById("catch").onclick = catchGhost(locationNum);
            return true;
        } else {
            console.log("no!")
            return false;
        }
    }

    function toggleText() {
    var text = document.getElementById("catch");
    if (text.style.display === "none") {
        text.style.display = "block";
    }
    }

    function catchGhost(locationNum){
        //https://lage.us/Javascript-Pass-Variables-to-Another-Page.html
        var LatLng = circles[locationNum];
        var lat = circles[locationNum][0];
        var lng = circles[locationNum][1];
        var title = locationData[locationNum][0];
        var info = locationData[locationNum][1];
        var image = locationData[locationNum][2];

        sessionStorage.setItem("lat", lat);
        sessionStorage.setItem("lng", lng);
        sessionStorage.setItem("title", title);
        sessionStorage.setItem("info", info);
        sessionStorage.setItem("image", image);

    }
</script>